# サーバソフトウェア運用者向けガイド

Personiumのサーバソフトウェアを使ってPersoniumユニットを構築する方や、Personiumサーバプログラムをビルド・デプロイ・設定する方、
Personiumを使用したPDSサービス環境を提供・運用したい方向けのドキュメントです。

構築・設定済のPersoniumユニットに対してユニットユーザトークンを使ってアクセスして、 ユニット管理者の主たる業務、すなわちCellの作成・払出しや、払出したCellの管理等を実施する方は、[ユニット管理者向けガイド](../unit-administrator/)をご覧ください。

## ユニット構成設計

Personiumはスケーラブルなアーキテクチャを採用しています。評価用や個人利用であれば1台のマシンにすべてを詰め込んだPersoniumユニットを構築することも可能です。一方で数百人、数千人が使うユニットを構築するには、セキュリティや性能といった非機能が必要となるため、Web層-AP層-DB層といった層構成をとるのが推奨されますので、最低2-3台の構成をとるべきでしょう。さらに数万人～数十万人以上が日々使う大規模なユニット構成するためには各層をスケールアウトさせ、10台-20台といった構成をとることとなります。

まずは、どのような構成のユニットを作るべきかを決め、必要なインフラ設計をしましょう。

## ユニットの構築

ユニットの構築にはAnsibleを使うのが便利です。またOpen Stack ベースのクラウド環境に構築する場合は Heat Template を使えば、ほぼ自動でユニット構築が可能です。もちろん、これら自動構築ツールを使わないで任意のクラウドや物理/仮想マシンを使ってユニット構築を行うこともできます。しかし、そのための手順等ドキュメントを私たちが準備しメンテナンスする体力がないため、以下Open StackのHeatを使ったサーバインフラ構築手順やAnsibleを使ったユニット自動構築手順を参考に構築を行ってください。

さまざまな環境でユニットが構築できたというお話をコミュニティの#infraチャネルで聞かせて頂けると嬉しく思います。

### Open Stack Heatを使ったサーバインフラの自動構築

* [Heatを使ったサーバインフラの自動構築](https://github.com/personium/openstack-heat)

### Ansibleを使ったユニットの自動構築

Ansibleを使って、評価用の1台構成のユニットや小規模な本番利用のための3台構成のユニットを構築するためのガイドを公開しています。

* [Ansibleを使ったユニット構築ガイド](./setup.md)

上記で紹介しているAnsibleのPlaybookをカスタマイズすれば様々な構成のユニットを構築可能です。

### ユニット構築後のチュートリアル

Personiumユニットを管理するための基本的な流れをご理解いただけるようチュートリアルを公開しています。
Personiumユニットを初めて管理される方は是非ともご活用ください。

* [Personiumユニット管理 チュートリアル](./tutorial.md)

### Pluginの導入

* [認証Pluginのセットアップ](./setup_authentication_plugins.md)
* [Engine Extensionのセットアップ](./setup_engine_extensions.md)

## ユニットの設定

ユニットの構成ができたら、ユニットを正しく設定する必要があります。
Ansibleで自動構築ユニットには基本的な設定はひととおりされていますが、完全ではありません。以下を参照し適切な設定を行ってください。

* [Unitの運用設計と設定](./unit_operation_design.md)
* [Unitの設定一覧](./unit_config_list.md)
* [Unit間連携の設定方法](./unit_coordination.md)

## ユニットの起動・停止

設定が終わったらユニットの起動です。以下の順序で各サーバの起動を行ってください。

|起動順序|起動方法|
|:--|:--|
|1|Memcached, ElasticSearch, ActiveMQ|
|2|Tomcat|
|3|Nginx|

停止については上記の逆順で実施ください。


## ユニットの運用

多くの場合Personiumのユニットには個人のプライバシーに関わる情報が入りますし、そもそもインターネット上にサーバを立てる上でセキュリティ対策は必須です。初期構築されたままでユニットを放置せず、適切にセキュリティパッチを適用してください。


### 関連するリポジトリ

* [ansible](https://github.com/personium/ansible)
* [openstack-heat](https://github.com/personium/openstack-heat)
* [openstack-heat_cent6_8](https://github.com/personium/openstack-heat_cent6_8)
